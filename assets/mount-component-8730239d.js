import{G as e,M as o,w as t,r as s,d as n,v as a,T as l,l as r,z as c,c as i,u,s as d,J as p,O as m,ab as v,F as f,m as h,ac as y,I as w}from"./index-21254b6f.js";import{K as I,R as b,n as x,t as k,F as O,o as g,S as C,p as S,c as z,f as A,l as B,g as j,B as P,b as L,d as E}from"./with-install-460172ae.js";import{u as R}from"./use-expose-c9171c69.js";import{u as F}from"./use-touch-cfd7c7a6.js";import{P as T}from"./on-popup-reopen-d10a579d.js";import{u as D,I as H}from"./index-e4150b28.js";import{H as $}from"./constant-1f96826c.js";function K(e,{args:o=[],done:t,canceled:s}){if(e){const n=e.apply(null,o);I(n)?n.then((e=>{e?t():s&&s()})).catch(b):n?t():s&&s()}else t()}const N={show:Boolean,zIndex:x,overlay:k,duration:x,teleport:[String,Object],lockScroll:k,lazyRender:k,beforeClose:Function,overlayStyle:Object,overlayClass:O,transitionAppear:Boolean,closeOnClickOverlay:k};let q=0;const G="van-overflow-hidden";function J(e){const o=s(!1);return t(e,(e=>{e&&(o.value=e)}),{immediate:!0}),e=>()=>o.value?e():null}const[M,V]=z("overlay");const Y=L(n({name:M,props:{show:Boolean,zIndex:x,duration:x,className:O,lockScroll:k,lazyRender:k,customStyle:Object},setup(e,{slots:o}){const t=s(),n=J((()=>e.show||!e.lazyRender))((()=>{var s;const n=B(j(e.zIndex),e.customStyle);return P(e.duration)&&(n.animationDuration=`${e.duration}s`),r(a("div",{ref:t,style:n,class:[V(),e.className]},[null==(s=o.default)?void 0:s.call(o)]),[[c,e.show]])}));return A("touchmove",(o=>{e.lockScroll&&S(o,!0)}),{target:t}),()=>a(l,{name:"van-fade",appear:!0},{default:n})}})),Q=B({},N,{round:Boolean,position:E("center"),closeIcon:E("cross"),closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,closeIconPosition:E("top-right"),safeAreaInsetTop:Boolean,safeAreaInsetBottom:Boolean}),[U,W]=z("popup");const X=L(n({name:U,inheritAttrs:!1,props:Q,emits:["open","close","opened","closed","keydown","update:show","clickOverlay","clickCloseIcon"],setup(n,{emit:y,attrs:w,slots:I}){let b,x;const k=s(),O=s(),z=J((()=>n.show||!n.lazyRender)),B=i((()=>{const e={zIndex:k.value};if(P(n.duration)){e["center"===n.position?"animationDuration":"transitionDuration"]=`${n.duration}s`}return e})),j=()=>{b||(b=!0,k.value=void 0!==n.zIndex?+n.zIndex:D(),y("open"))},L=()=>{b&&K(n.beforeClose,{done(){b=!1,y("close"),y("update:show",!1)}})},E=e=>{y("clickOverlay",e),n.closeOnClickOverlay&&L()},N=()=>{if(n.overlay)return a(Y,{show:n.show,class:n.overlayClass,zIndex:k.value,duration:n.duration,customStyle:n.overlayStyle,role:n.closeOnClickOverlay?"button":void 0,tabindex:n.closeOnClickOverlay?0:void 0,onClick:E},{default:I["overlay-content"]})},M=e=>{y("clickCloseIcon",e),L()},V=()=>{if(n.closeable)return a(H,{role:"button",tabindex:0,name:n.closeIcon,class:[W("close-icon",n.closeIconPosition),$],classPrefix:n.iconPrefix,onClick:M},null)},Q=()=>y("opened"),U=()=>y("closed"),X=e=>y("keydown",e),Z=z((()=>{var e;const{round:o,position:t,safeAreaInsetTop:s,safeAreaInsetBottom:l}=n;return r(a("div",h({ref:O,style:B.value,role:"dialog",tabindex:0,class:[W({round:o,[t]:t}),{"van-safe-area-top":s,"van-safe-area-bottom":l}],onKeydown:X},w),[null==(e=I.default)?void 0:e.call(I),V()]),[[c,n.show]])})),_=()=>{const{position:e,transition:o,transitionAppear:t}=n;return a(l,{name:o||("center"===e?"van-fade":`van-popup-slide-${e}`),appear:t,onAfterEnter:Q,onAfterLeave:U},{default:Z})};return t((()=>n.show),(e=>{e&&!b&&(j(),0===w.tabindex&&u((()=>{var e;null==(e=O.value)||e.focus()}))),!e&&b&&(b=!1,y("close"))})),R({popupRef:O}),function(s,n){const a=F(),l=e=>{a.move(e);const o=a.deltaY.value>0?"10":"01",t=C(e.target,s.value),{scrollHeight:n,offsetHeight:l,scrollTop:r}=t;let c="11";0===r?c=l>=n?"00":"01":r+l>=n&&(c="10"),"11"===c||!a.isVertical()||parseInt(c,2)&parseInt(o,2)||S(e,!0)},r=()=>{document.addEventListener("touchstart",a.start),document.addEventListener("touchmove",l,{passive:!1}),q||document.body.classList.add(G),q++},c=()=>{q&&(document.removeEventListener("touchstart",a.start),document.removeEventListener("touchmove",l),q--,q||document.body.classList.remove(G))},i=()=>n()&&c();g((()=>n()&&r())),e(i),o(i),t(n,(e=>{e?r():c()}))}(O,(()=>n.show&&n.lockScroll)),A("popstate",(()=>{n.closeOnPopstate&&(L(),x=!1)})),d((()=>{n.show&&j()})),p((()=>{x&&(y("update:show",!0),x=!1)})),e((()=>{n.show&&n.teleport&&(L(),x=!0)})),m(T,(()=>n.show)),()=>n.teleport?a(v,{to:n.teleport},{default:()=>[N(),_()]}):a(f,null,[N(),_()])}}));function Z(){const e=w({show:!1}),o=o=>{e.show=o},t=t=>{B(e,t,{transitionAppear:!0}),o(!0)},s=()=>o(!1);return R({open:t,close:s,toggle:o}),{open:t,close:s,state:e,toggle:o}}function _(e){const o=y(e),t=document.createElement("div");return document.body.appendChild(t),{instance:o.mount(t),unmount(){o.unmount(),document.body.removeChild(t)}}}export{X as P,K as c,_ as m,N as p,Z as u};
