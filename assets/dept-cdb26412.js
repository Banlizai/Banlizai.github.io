import{g as e,A as t,p as a,G as s,u as o,b as r,U as i,r as n,w as d,f as l,h as c,i as p,j as m,k as u,l as y,m as j,M as f}from"./index-0ca45986.js";import{M as h,n as g,B as w,Y as v}from"./@arco-design-8dabd30f.js";import{a as b,b as C,u as k,c as I,d as S,e as _}from"./columns-1685844f.js";import{d as x,u as A,h as D,a_ as R,o as L,c as O,f as z,s as B,w as K,N,m as U,C as E,a1 as T,Y as V,D as $,F as q,r as F}from"./@vue-2b41ce19.js";import{a as M}from"./@vueuse-ca9a384d.js";import"./pinia-b3c1485e.js";import"./axios-6371c10e.js";import"./@logicflow-85f8458e.js";import"./ids-ef071351.js";import"./lodash-es-1e3e3aa2.js";import"./preact-5fc9b0bf.js";import"./qs-f981fe00.js";import"./side-channel-01aeb4d9.js";import"./get-intrinsic-bac01933.js";import"./has-symbols-456daba2.js";import"./has-proto-4a87f140.js";import"./function-bind-72d06d3b.js";import"./has-885c3436.js";import"./call-bind-fae29077.js";import"./object-inspect-0eda087e.js";import"./dayjs-094145ee.js";import"./path-browserify-8c7c24dd.js";import"./vue-router-70e2faff.js";import"./tiny-emitter-35dc7566.js";import"./echarts-24943dbb.js";import"./zrender-2d3b2bba.js";import"./tslib-a4e99503.js";import"./xgplayer-700bd6a3.js";import"./delegate-ef66b241.js";import"./downloadjs-91c0ea73.js";import"./quill-ecb3881d.js";import"./sortablejs-2f5483e3.js";import"./b-tween-5055d79e.js";import"./b-validate-457088db.js";import"./resize-observer-polyfill-ad543aa3.js";import"./scroll-into-view-if-needed-59a60a09.js";import"./compute-scroll-into-view-2962e95c.js";import"./number-precision-d9b928a1.js";import"./dict-9c237ae6.js";const P={class:"main-container"},Y=x({__name:"dept",setup(x){const{ADD:Y,UPDATE:G}=f,H=o(),J=A(null),Q=b(me),W=C(),{selectedRowKeys:X,onSelectionChange:Z,showCheckedAll:ee}=k(),{bordered:te,striped:ae,handleSuccess:se,tableLoading:oe,dataList:re}=W,ie=_("deptId"),{dept:ne}=I(),de=ne,{onSorterChange:le,sortOrder:ce}=S(me),pe=A();async function me(){oe.value=!0;try{const{code:t,data:a,msg:s,total:o}=await(async t=>await e({url:"/system/dept/list",data:t}))({pageNum:Q.page,pageSize:Q.pageSize,orderByColumn:ce.orderBy,isAsc:ce.isAsc,...r(de)}),n={code:t,msg:s,data:i(a,0,"deptId")};oe.value=!1,pe.value=i(a,0,"deptId"),se(F(n)),Q.setTotalSize(o||10)}catch(t){}}function ue(){de.forEach((e=>{e.searchReset?e.searchReset():e.searchValue=void 0})),me()}const ye=e=>{const t=e.deptId||X.value.toString();t?g.confirm({title:"提示",content:`确定要${e?"删除此":"删除所选择的"}数据吗？`,cancelText:"取消",okText:"删除",onOk:async()=>{try{const{msg:e}=await(async e=>await s({url:`/system/dept/${e}`}))(t);h.success(e),me()}catch(e){}}}):h.error("请选择要删除的数据")};function je(){var e;fe(),H.title=Y,H.itemOption=de,null==(e=J.value)||e.show()}async function fe(t=void 0){if(!t)return void de.find((e=>{"parentId"===e.key&&(e.optionItems=n(pe.value,"deptId","deptName"))}));const{data:a}=await(async t=>await e({url:`/system/dept/list/exclude/${t}`}))(t);de.find((e=>{"parentId"===e.key&&(e.optionItems=n(i(a,0,"deptId"),"deptId","deptName"))}))}const he=async()=>{var e;try{const s=H.itemOption.find((e=>"deptId"===e.key)),o=d(H.itemOption),{msg:r}=(null==s?void 0:s.value)?await(async e=>await a({url:"/system/dept",data:e}))(o):await(async e=>await t({url:"/system/dept",data:e}))(o);h.success(r),null==(e=J.value)||e.close(),me()}catch(s){}},ge=M((async({record:t})=>{try{const{data:a}=await(async t=>await e({url:`/system/dept/${t}`}))(t.deptId);de.forEach((e=>{e.value=a[e.key]}))}catch(a){}}),300);return D(me),(e,t)=>{const a=w,s=l,o=c,r=p,i=v,n=m,d=u,f=y,h=j,g=R("hasPerm");return L(),O(q,null,[z("div",P,[B(f,{ref:"tableBody"},{header:K((()=>[B(r,{"show-filter":!0,title:"",onSearch:me,onResetSearch:ue},{"more-button-content":K((()=>[N((L(),U(a,{type:"primary",onClick:je},{default:K((()=>[E(" 添加 ")])),_:1})),[[g,["system:dept:add"]]]),N((L(),U(a,{status:"danger",onClick:ye},{default:K((()=>[E("删除")])),_:1})),[[g,["system:dept:remove"]]])])),"search-content":K((()=>[B(s,{modelValue:T(de),"onUpdate:modelValue":t[0]||(t[0]=e=>V(de)?de.value=e:null)},null,8,["modelValue"])])),"table-config":K((()=>[B(o,{tableColumns:T(de),"onUpdate:border":t[1]||(t[1]=e=>T(W).bordered.value=e),"onUpdate:striped":t[2]||(t[2]=e=>T(W).striped.value=e),onDoRefresh:me},null,8,["tableColumns"])])),_:1})])),default:K((()=>[B(n,{bordered:T(te),striped:T(ae),tableLoading:T(oe),dataList:T(re),tableColumns:T(de),rowKey:T(ie),onSelectionChange:T(Z),selectedRowKeys:T(X),showCheckedAll:T(ee),onSorterChange:T(le)},{optional:K((({record:e})=>[N((L(),U(a,{type:"primary",onClick:t=>(async e=>{var t;fe(e.deptId),H.title=G,H.itemOption=de,null==(t=J.value)||t.show(),await ge({record:e})})(e)},{default:K((()=>[E("编辑")])),_:2},1032,["onClick"])),[[g,["system:dept:edit"]]]),N((L(),U(a,{status:"danger",onClick:t=>ye(e)},{default:K((()=>[E("删除")])),_:2},1032,["onClick"])),[[g,["system:dept:remove"]]])])),status:K((({record:e})=>[B(i,{color:1===e.status?"green":"red"},{default:K((()=>[E($(1===e.status?"正常":"禁用"),1)])),_:2},1032,["color"])])),parentId:K((({record:e})=>[E($(e.parentName),1)])),_:1},8,["bordered","striped","tableLoading","dataList","tableColumns","rowKey","onSelectionChange","selectedRowKeys","showCheckedAll","onSorterChange"])])),footer:K((()=>[B(d,{pagination:T(Q)},null,8,["pagination"])])),_:1},512)]),B(h,{ref_key:"modalDialog",ref:J,config:T(H),onConfirm:he},null,8,["config"])],64)}}});export{Y as default};
