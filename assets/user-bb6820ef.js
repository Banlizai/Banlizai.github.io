import{_ as e,u as a,o as s,a as t,q as o,b as r,t as l,r as n,e as i,v as d,s as c,w as u,x as m,f as p,h as y,i as f,j as h,k as j,l as v,m as g,M as b}from"./index-0ca45986.js";import{M as k,n as w,B as C,U as I,ao as _,v as x,Y as S,A as V}from"./@arco-design-8dabd30f.js";import{a as O,b as A,u as T,c as U,d as R,e as D,f as E}from"./columns-1685844f.js";import{a as L,b as z,c as B,d as K,e as N,f as q,g as P,h as F,i as M}from"./user-38648499.js";import{a as Y}from"./post-ad3b8162.js";import{a as H}from"./role-1d4bb45a.js";import{d as J,ar as $,u as G,h as Q,a_ as W,o as X,c as Z,f as ee,s as ae,w as se,N as te,a1 as oe,Y as re,C as le,m as ne,F as ie,r as de}from"./@vue-2b41ce19.js";import{a as ce}from"./@vueuse-ca9a384d.js";import"./pinia-b3c1485e.js";import"./axios-6371c10e.js";import"./@logicflow-85f8458e.js";import"./ids-ef071351.js";import"./lodash-es-1e3e3aa2.js";import"./preact-5fc9b0bf.js";import"./qs-f981fe00.js";import"./side-channel-01aeb4d9.js";import"./get-intrinsic-bac01933.js";import"./has-symbols-456daba2.js";import"./has-proto-4a87f140.js";import"./function-bind-72d06d3b.js";import"./has-885c3436.js";import"./call-bind-fae29077.js";import"./object-inspect-0eda087e.js";import"./dayjs-094145ee.js";import"./path-browserify-8c7c24dd.js";import"./vue-router-70e2faff.js";import"./tiny-emitter-35dc7566.js";import"./echarts-24943dbb.js";import"./zrender-2d3b2bba.js";import"./tslib-a4e99503.js";import"./xgplayer-700bd6a3.js";import"./delegate-ef66b241.js";import"./downloadjs-91c0ea73.js";import"./quill-ecb3881d.js";import"./sortablejs-2f5483e3.js";import"./b-tween-5055d79e.js";import"./b-validate-457088db.js";import"./resize-observer-polyfill-ad543aa3.js";import"./scroll-into-view-if-needed-59a60a09.js";import"./compute-scroll-into-view-2962e95c.js";import"./number-precision-d9b928a1.js";import"./dict-9c237ae6.js";const ue={class:"main-container"},me=J({__name:"user",setup(J){const me=$((()=>e((()=>import("./index-0ca45986.js").then((e=>e.a7))),["assets/index-0ca45986.js","assets/@vue-2b41ce19.js","assets/@arco-design-8dabd30f.js","assets/b-tween-5055d79e.js","assets/b-validate-457088db.js","assets/resize-observer-polyfill-ad543aa3.js","assets/scroll-into-view-if-needed-59a60a09.js","assets/compute-scroll-into-view-2962e95c.js","assets/number-precision-d9b928a1.js","assets/dayjs-094145ee.js","assets/@logicflow-85f8458e.js","assets/ids-ef071351.js","assets/lodash-es-1e3e3aa2.js","assets/preact-5fc9b0bf.js","assets/@logicflow-4fbf093d.css","assets/@arco-design-766c8d5e.css","assets/pinia-b3c1485e.js","assets/axios-6371c10e.js","assets/qs-f981fe00.js","assets/side-channel-01aeb4d9.js","assets/get-intrinsic-bac01933.js","assets/has-symbols-456daba2.js","assets/has-proto-4a87f140.js","assets/function-bind-72d06d3b.js","assets/has-885c3436.js","assets/call-bind-fae29077.js","assets/object-inspect-0eda087e.js","assets/path-browserify-8c7c24dd.js","assets/vue-router-70e2faff.js","assets/@vueuse-ca9a384d.js","assets/tiny-emitter-35dc7566.js","assets/echarts-24943dbb.js","assets/zrender-2d3b2bba.js","assets/tslib-a4e99503.js","assets/xgplayer-700bd6a3.js","assets/delegate-ef66b241.js","assets/downloadjs-91c0ea73.js","assets/quill-ecb3881d.js","assets/quill-8e59e50e.css","assets/sortablejs-2f5483e3.js","assets/index-29e4a384.css"]))),{ADD:pe,UPDATE:ye}=b,fe=a(),he=G(null),je=O(De),ve=A(),{selectedRowKeys:ge,onSelectionChange:be,showCheckedAll:ke}=T(),{bordered:we,striped:Ce,handleSuccess:Ie,tableLoading:_e,dataList:xe}=ve,Se=D("userId"),{user:Ve}=U(),Oe=Ve,{onSorterChange:Ae,sortOrder:Te}=R(De),Ue=E("部门","dept"),Re=G();async function De(){_e.value=!0;try{const{code:e,rows:a,msg:s,total:t}=await z({pageNum:je.page,pageSize:je.pageSize,orderByColumn:Te.orderBy,isAsc:Te.isAsc,...r(Oe)});_e.value=!1;Ie(de({code:e,msg:s,data:a})),je.setTotalSize(t||10)}catch(e){}}async function Ee(e,a){Oe.forEach((a=>{"deptId"===a.key&&(a.searchValue=e[0])})),De()}function Le(){Oe.forEach((e=>{e.searchReset?e.searchReset():e.searchValue=void 0})),De()}const ze=e=>{const a=e.userId||ge.value.toString();a?w.confirm({title:"提示",content:`确定要${e?"删除此":"删除所选择的"}数据吗？`,cancelText:"取消",okText:"删除",onOk:async()=>{try{const{msg:e}=await B(a);k.success(e),De()}catch(e){}}}):k.error("请选择要删除的数据")};function Be(){var e;fe.title=pe,fe.itemOption=Oe,null==(e=he.value)||e.show()}const Ke=async()=>{try{i(d,r(Oe),"用户管理")}catch(e){}},Ne=async()=>{var e,a,s;try{const t=fe.itemOption.find((e=>"userId"===e.key)),o=null==(e=fe.itemOption.find((e=>"roleIds"===e.key)))?void 0:e.optionItems,r=(null==(a=fe.itemOption.find((e=>"deptId"===e.key)))?void 0:a.optionItems)||[],l=c(r,[]),n=u(fe.itemOption);n.roleIds&&(n.roles=null==o?void 0:o.filter((e=>null==n?void 0:n.roleIds.includes(e.roleId)))),n.deptId&&(n.dept=null==l?void 0:l.find((e=>e.deptId===n.deptId)));const{msg:i}=(null==t?void 0:t.value)?await P(n):await F(n);k.success(i),null==(s=he.value)||s.close(),De()}catch(t){}},qe=ce((async({record:e})=>{try{const{data:a,roleIds:s,postIds:t}=await M(e.userId);Oe.forEach((e=>{e.value=a[e.key],"roleIds"===e.key&&(e.value=s),"postIds"===e.key&&(e.value=t)}))}catch(a){}}),300);return Q((()=>{!async function(){try{const{data:e}=await H();Oe.find((a=>{"roleIds"!==a.key||(a.optionItems=l(e,"roleId","roleName"))}))}catch(e){}}(),async function(){try{const{data:e}=await N(r(Oe));Oe.find((a=>{"deptId"!==a.key||(a.optionItems=n(e,"id","label"))})),Re.value=n(e,"id","label")}catch(e){}}(),async function(){try{const{data:e}=await Y();Oe.find((a=>{"postIds"!==a.key||(a.optionItems=l(e,"postId","postName"))}))}catch(e){}}(),De()})),(e,a)=>{const r=m,l=C,n=p,i=y,d=f,c=I,u=_,b=x,O=S,A=V,T=h,U=j,R=v,D=g,E=W("hasPerm");return X(),Z(ie,null,[ee("div",ue,[ae(R,{ref:"tableBody"},{header:se((()=>[ae(d,{"show-filter":!0,title:"",onSearch:De,onResetSearch:Le},{"more-button-content":se((()=>[te((X(),Z("div",null,[ae(r,{modelValue:oe(L),"onUpdate:modelValue":a[0]||(a[0]=e=>re(L)?L.value=e:null),urlTemplate:oe(s),onUpdate:De},{default:se((()=>[le(" 导入 ")])),_:1},8,["modelValue","urlTemplate"])])),[[E,["system:user:import"]]]),te((X(),ne(l,{type:"primary",loading:oe(t),onClick:Ke},{default:se((()=>[le(" 导出用户 ")])),_:1},8,["loading"])),[[E,["system:user:export"]]]),te((X(),ne(l,{type:"primary",onClick:Be},{default:se((()=>[le(" 添加 ")])),_:1})),[[E,["system:user:add"]]]),te((X(),ne(l,{status:"danger",onClick:ze},{default:se((()=>[le("删除")])),_:1})),[[E,["system:user:remove"]]])])),"search-content":se((()=>[ae(n,{modelValue:oe(Oe),"onUpdate:modelValue":a[1]||(a[1]=e=>re(Oe)?Oe.value=e:null)},null,8,["modelValue"])])),"table-config":se((()=>[ae(i,{tableColumns:oe(Oe),"onUpdate:border":a[2]||(a[2]=e=>oe(ve).bordered.value=e),"onUpdate:striped":a[3]||(a[3]=e=>oe(ve).striped.value=e),onDoRefresh:De},null,8,["tableColumns"])])),_:1})])),default:se((()=>[ae(oe(me),null,{tree:se((()=>[ae(c,{blockNode:"",data:Re.value,onSelect:Ee},null,8,["data"])])),table:se((()=>[ae(T,{bordered:oe(we),striped:oe(Ce),tableLoading:oe(_e),dataList:oe(xe),tableColumns:oe(Oe),rowKey:oe(Se),expandable:oe(Ue),onSorterChange:oe(Ae),onSelectionChange:oe(be),selectedRowKeys:oe(ge),showCheckedAll:oe(ke)},{optional:se((({record:e})=>[ae(u,{type:"primary"},{default:se((()=>[te((X(),ne(l,{onClick:a=>(async e=>{var a;fe.title=ye,fe.itemOption=Oe,null==(a=he.value)||a.show(),await qe({record:e})})(e)},{default:se((()=>[le(" 编辑 ")])),_:2},1032,["onClick"])),[[E,["system:user:edit"]]]),te((X(),ne(l,{onClick:a=>ze(e)},{default:se((()=>[le(" 删除 ")])),_:2},1032,["onClick"])),[[E,["system:user:remove"]]]),te((X(),ne(l,{onClick:a=>(async e=>{w.confirm({title:"提示",content:"确定要重置密码吗？",cancelText:"取消",okText:"重置",onOk:async()=>{try{const{msg:a}=await q(e);k.success(a),De()}catch(a){}}})})(e)},{default:se((()=>[le(" 重置密码 ")])),_:2},1032,["onClick"])),[[E,["system:user:resetPwd"]]])])),_:2},1024)])),status:se((({record:e})=>[ae(b,{type:"round",modelValue:e.status,"onUpdate:modelValue":a=>e.status=a,"checked-value":"0","unchecked-value":"1",beforeChange:a=>(async(e,a)=>{try{const s=await K({...a,status:e});return k.success(s.msg),!0}catch(s){return!1}})(a,e)},{checked:se((()=>[le(" 启用 ")])),unchecked:se((()=>[le(" 停用 ")])),_:2},1032,["modelValue","onUpdate:modelValue","beforeChange"])])),sex:se((({record:e})=>["1"===e.sex?(X(),ne(O,{key:0,color:"blue"},{default:se((()=>[le(" 男 ")])),_:1})):(X(),ne(O,{key:1,color:"pink"},{default:se((()=>[le("女")])),_:1}))])),admin:se((({record:e})=>[e.admin?(X(),ne(O,{key:0,color:"green"},{default:se((()=>[le(" 是 ")])),_:1})):(X(),ne(O,{key:1,color:"red"},{default:se((()=>[le("否")])),_:1}))])),avatar:se((({record:e})=>[ae(A,{"image-url":oe(o)(e.avatar)},null,8,["image-url"])])),_:1},8,["bordered","striped","tableLoading","dataList","tableColumns","rowKey","expandable","onSorterChange","onSelectionChange","selectedRowKeys","showCheckedAll"])])),_:1})])),footer:se((()=>[ae(U,{pagination:oe(je)},null,8,["pagination"])])),_:1},512)]),ae(D,{ref_key:"modalDialog",ref:he,config:oe(fe),onConfirm:Ne},null,8,["config"])],64)}}});export{me as default};
