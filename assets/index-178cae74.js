import{c as s,m as t,n as a,e,f as n,h as i,p as o,b as u}from"./with-install-460172ae.js";import{u as l}from"./use-touch-cfd7c7a6.js";import{L as r}from"./index-369c902b.js";import{d as c,r as d,I as h,w as g,v as m,u as p}from"./index-21254b6f.js";const[f,v,x]=s("pull-refresh"),T=["pulling","loosing","success"];const D=u(c({name:f,props:{disabled:Boolean,modelValue:Boolean,headHeight:t(50),successText:String,pullingText:String,loosingText:String,loadingText:String,pullDistance:a,successDuration:t(500),animationDuration:t(300)},emits:["change","refresh","update:modelValue"],setup(s,{emit:t,slots:a}){let u;const c=d(),f=d(),D=e(c),H=h({status:"normal",distance:0,duration:0}),V=l(),j=()=>{if(50!==s.headHeight)return{height:`${s.headHeight}px`}},S=()=>"loading"!==H.status&&"success"!==H.status&&!s.disabled,$=(a,e)=>{const n=+(s.pullDistance||s.headHeight);H.distance=a,H.status=e?"loading":0===a?"normal":a<n?"pulling":"loosing",t("change",{status:H.status,distance:a})},b=()=>{const{status:t}=H;return"normal"===t?"":s[`${t}Text`]||x(t)},B=()=>{const{status:s,distance:t}=H;if(a[s])return a[s]({distance:t});const e=[];return T.includes(s)&&e.push(m("div",{class:v("text")},[b()])),"loading"===s&&e.push(m(r,{class:v("loading")},{default:b})),e},w=s=>{u=0===i(D.value),u&&(H.duration=0,V.start(s))},y=s=>{S()&&w(s)},P=()=>{u&&V.deltaY.value&&S()&&(H.duration=+s.animationDuration,"loosing"===H.status?($(+s.headHeight,!0),t("update:modelValue",!0),p((()=>t("refresh")))):$(0))};return g((()=>s.modelValue),(t=>{H.duration=+s.animationDuration,t?$(+s.headHeight,!0):a.success||s.successText?(H.status="success",setTimeout((()=>{$(0)}),+s.successDuration)):$(0,!1)})),n("touchmove",(t=>{if(S()){u||w(t);const{deltaY:a}=V;V.move(t),u&&a.value>=0&&V.isVertical()&&(o(t),$((t=>{const a=+(s.pullDistance||s.headHeight);return t>a&&(t=t<2*a?a+(t-a)/2:1.5*a+(t-2*a)/4),Math.round(t)})(a.value)))}}),{target:f}),()=>{var s;const t={transitionDuration:`${H.duration}ms`,transform:H.distance?`translate3d(0,${H.distance}px, 0)`:""};return m("div",{ref:c,class:v()},[m("div",{ref:f,class:v("track"),style:t,onTouchstartPassive:y,onTouchend:P,onTouchcancel:P},[m("div",{class:v("head"),style:j()},[B()]),null==(s=a.default)?void 0:s.call(a)])])}}}));export{D as P};
